var nextTick = require('breeze-nexttick');

var Ref = require('./ref');

exports.actorOf = function (Ctx, system, parentRef, options) {
  var name = options.name
    , opts = options.opts || {}
    , parent = parentRef
      ? system.registry.lookup(parentRef)
      : null
    , spec = options.spec

  var ctx = new Ctx({
      parent: parentRef
    , ref: new Ref(parentRef, name)
    , system: system
  });

  system.register(ctx, spec);

  if (parent && parent.ctx) {
    parent.ctx.children.add(ctx.ref);
  }

  if (false !== opts.start) {
    nextTick(function () {
      ctx.start();
    });
  }

  return ctx.ref;
};
