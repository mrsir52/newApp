
var type = require('tea-type');

function clean (s) {
  return s && 'string' === type(s);
}

function normalize (arr, root) {
  var i = arr.length - 1
    , u = 0
    , e;

  for (; i >= 0; i--) {
    e = arr[i];
    if ('.' === e) {
      arr.splice(i, 1);
    } else if ('..' === e) {
      arr.splice(i, 1);
      u++;
    } else if (u) {
      arr.splice(i, 1);
      u--;
    }
  }

  if (root) {
    for (; u--; u) {
      arr.unshift('..');
    }
  }

  return arr;
}

exports.resolve = function () {
  var args = [].slice.call(arguments).filter(clean)
    , i = args.length - 1
    , res = ''
    , abs = false
    , path;

  for (; i >= -1 && !abs; i--) {
    path = args[i];
    res = path + '/' + res;
    abs = path.charAt(0) === '/';
  }

  res = res
    .split('/')
    .filter(clean);

  res = normalize(res, abs).join('/');
  return ((abs ? '/' : '') + res) || '.';
};
